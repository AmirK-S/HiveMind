---
phase: 03-quality-intelligence-sdks
plan: 07
type: execute
wave: 4
depends_on: ["03-02", "03-03"]
files_modified:
  - sdks/python/.gitkeep
  - sdks/typescript/.gitkeep
  - Makefile
  - hivemind/server/main.py
  - pyproject.toml
autonomous: true
requirements:
  - SDK-02
  - SDK-03

must_haves:
  truths:
    - "A Python SDK is generated from the OpenAPI spec with typed client and methods"
    - "A TypeScript SDK is generated from the OpenAPI spec with typed fetch-based client"
    - "Both SDKs provide methods matching the REST API endpoints (search, fetch, report_outcome)"
    - "A Makefile target 'generate-sdks' regenerates both SDKs from the running server"
    - "SDK clients use X-API-Key header for authentication"
  artifacts:
    - path: "Makefile"
      provides: "generate-sdks target for SDK regeneration"
      contains: "generate-sdks"
    - path: "sdks/python/.gitkeep"
      provides: "Python SDK output directory"
    - path: "sdks/typescript/.gitkeep"
      provides: "TypeScript SDK output directory"
  key_links:
    - from: "Makefile"
      to: "hivemind/server/main.py"
      via: "fetches OpenAPI spec from running server"
      pattern: "openapi.json"
    - from: "sdks/python"
      to: "/api/v1/"
      via: "generated client targets REST API endpoints"
      pattern: "api/v1"
---

<objective>
Generate Python and TypeScript SDKs from the REST API's OpenAPI spec.

Purpose: SDK-02 and SDK-03 require developers to integrate via Python and TypeScript clients. Generated SDKs stay in sync with the API automatically, preventing drift (research Pitfall 5). The SDKs target the REST API created in Plan 02, providing typed method calls for search, fetch, and outcome reporting.

Output: Generated Python SDK (openapi-python-client), generated TypeScript SDK (@hey-api/openapi-ts), Makefile target for regeneration, and dependency additions.
</objective>

<execution_context>
@/Users/amirkellousidhoum/.claude/get-shit-done/workflows/execute-plan.md
@/Users/amirkellousidhoum/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-quality-intelligence-sdks/03-RESEARCH.md

# Plan 02 creates the REST API that SDKs will target
@.planning/phases/03-quality-intelligence-sdks/03-02-SUMMARY.md
# Plan 03 adds outcome reporting endpoint
@.planning/phases/03-quality-intelligence-sdks/03-03-SUMMARY.md

@hivemind/server/main.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: OpenAPI spec polish and Python SDK generation</name>
  <files>
    sdks/python/.gitkeep
    hivemind/server/main.py
    pyproject.toml
  </files>
  <action>
    1. Ensure OpenAPI spec quality in `hivemind/server/main.py`:
       - Verify `generate_unique_id_function` is set on the FastAPI app (from Plan 02). If not, add it:
         ```python
         from fastapi.routing import APIRoute
         def custom_generate_unique_id(route: APIRoute) -> str:
             if route.tags:
                 return f"{route.tags[0]}_{route.name}"
             return route.name
         ```
       - Add API metadata to the FastAPI app constructor for better SDK docs:
         ```python
         app = FastAPI(
             title="HiveMind",
             description="Shared memory system for AI agents",
             version="0.1.0",
             generate_unique_id_function=custom_generate_unique_id,
             docs_url="/docs",          # Swagger UI
             redoc_url="/redoc",        # ReDoc
         )
         ```
       - Verify all REST endpoints have:
         - Descriptive `summary` and `description` in their decorators
         - Response model types (Pydantic models or dict type hints)
         - Proper `operation_id` for clean SDK method names

    2. Create SDK output directories:
       - `mkdir -p sdks/python sdks/typescript`
       - Create `sdks/python/.gitkeep` and `sdks/typescript/.gitkeep` to track empty dirs.

    3. Add `openapi-python-client` to dev dependencies in `pyproject.toml`:
       - Under `[project.optional-dependencies]` or `[tool.poetry.group.dev.dependencies]` (check existing format):
         Add `openapi-python-client` as a dev dependency.
       - Also ensure `httpx` is in runtime deps (already present).

    4. Generate the Python SDK:
       - The server must be running to generate from `/openapi.json`. Since we cannot run the server during plan execution (it needs a database), use an alternative approach:
       - Export the OpenAPI spec to a static file first:
         ```python
         # Add a script at scripts/export_openapi.py
         import json
         from hivemind.server.main import app
         spec = app.openapi()
         with open("openapi.json", "w") as f:
             json.dump(spec, f, indent=2)
         ```
       - Run: `python scripts/export_openapi.py` to generate the spec file.
       - Run: `openapi-python-client generate --path openapi.json --output-path sdks/python --overwrite`
       - The generated SDK will have:
         - `AuthenticatedClient` with base_url and token
         - Method per endpoint: `search_knowledge()`, `get_knowledge_item()`, `report_outcome()`
         - Typed request/response models

    5. Create a brief `sdks/python/README.md` (only because SDKs need usage docs for developers):
       ```
       # HiveMind Python SDK

       Auto-generated from the HiveMind REST API OpenAPI spec.

       ## Installation
       pip install -e sdks/python

       ## Usage
       from hivemind_client import AuthenticatedClient
       from hivemind_client.api.rest_api import search_knowledge

       client = AuthenticatedClient(base_url="http://localhost:8000", token="hm_your_api_key")
       response = search_knowledge.sync(client=client, query="redis timeouts")

       ## Regeneration
       make generate-sdks
       ```

    AVOID: Do NOT hand-write SDK code — generate it from the OpenAPI spec. Hand-written SDKs drift immediately (research anti-pattern).
    AVOID: Do NOT include the openapi.json in version control — it's a build artifact. Only the generated SDK code is committed.
  </action>
  <verify>
    Run `cd /Users/amirkellousidhoum/Desktop/Code/HiveMind && python -c "
import json
from hivemind.server.main import app
spec = app.openapi()
paths = list(spec.get('paths', {}).keys())
print('API paths:', paths)
print('Has /api/v1 paths:', any('/api/v1' in p for p in paths))
"` — should show REST API paths in the spec.
    Check `ls sdks/python/` — directory exists.
  </verify>
  <done>
    OpenAPI spec has clean operation IDs, API metadata, and response types. Python SDK generated from spec with typed client and method per endpoint. SDK directory and README exist. openapi-python-client added as dev dependency.
  </done>
</task>

<task type="auto">
  <name>Task 2: TypeScript SDK generation and Makefile target</name>
  <files>
    sdks/typescript/.gitkeep
    Makefile
  </files>
  <action>
    1. Generate TypeScript SDK:
       - First ensure the openapi.json spec file exists (generated in Task 1).
       - Run: `npx @hey-api/openapi-ts -i openapi.json -o sdks/typescript/src/client --plugins @hey-api/typescript @hey-api/sdk`
       - If npm/npx is not available in the environment, create a `package.json` at the project root (or sdks/typescript/) with the dev dependency:
         ```json
         {
           "name": "hivemind-sdks",
           "private": true,
           "devDependencies": {
             "@hey-api/openapi-ts": "latest"
           }
         }
         ```
       - The generated SDK will have:
         - Typed fetch-based client
         - Service classes per tag: `KnowledgeService.searchKnowledge()`, etc.
         - Zero runtime overhead (tree-shakable)

    2. Create a brief `sdks/typescript/README.md`:
       ```
       # HiveMind TypeScript SDK

       Auto-generated from the HiveMind REST API OpenAPI spec.

       ## Installation
       npm install ./sdks/typescript

       ## Usage
       import { client, searchKnowledge } from './client';

       client.setConfig({ baseUrl: 'http://localhost:8000' });
       client.interceptors.request.use((request) => {
         request.headers.set('X-API-Key', 'hm_your_api_key');
         return request;
       });

       const results = await searchKnowledge({ query: { query: 'redis timeouts' } });

       ## Regeneration
       make generate-sdks
       ```

    3. Create `Makefile` at project root with SDK generation targets:
       ```makefile
       .PHONY: generate-sdks generate-openapi generate-python-sdk generate-ts-sdk

       generate-openapi:
       	python scripts/export_openapi.py

       generate-python-sdk: generate-openapi
       	openapi-python-client generate \
       	  --path openapi.json \
       	  --output-path sdks/python \
       	  --overwrite

       generate-ts-sdk: generate-openapi
       	npx @hey-api/openapi-ts \
       	  -i openapi.json \
       	  -o sdks/typescript/src/client

       generate-sdks: generate-python-sdk generate-ts-sdk
       	@echo "SDKs generated successfully"

       # CI drift check — fails if generated code differs from committed
       check-sdk-drift: generate-sdks
       	git diff --exit-code sdks/ || (echo "SDK drift detected! Run 'make generate-sdks' and commit." && exit 1)
       ```

    4. If a Makefile already exists, add these targets to it. If not, create it.

    AVOID: Do NOT use openapi-typescript-codegen — it is abandoned. Use @hey-api/openapi-ts which is the actively maintained fork (research State of the Art).
  </action>
  <verify>
    Run `cd /Users/amirkellousidhoum/Desktop/Code/HiveMind && test -f Makefile && grep -q 'generate-sdks' Makefile && echo 'Makefile OK' || echo 'Makefile missing target'`
    Run `ls sdks/typescript/` — directory exists.
  </verify>
  <done>
    TypeScript SDK generated from OpenAPI spec with typed fetch-based client. Makefile has generate-sdks target that regenerates both SDKs. CI drift check target (check-sdk-drift) fails the build if generated SDKs differ from committed code. Both SDKs have usage README files.
  </done>
</task>

</tasks>

<verification>
1. `python scripts/export_openapi.py` generates valid openapi.json
2. Python SDK directory has generated client code
3. TypeScript SDK directory has generated client code
4. `make generate-sdks` runs without errors (when deps installed)
5. Both SDKs have methods matching REST endpoints
6. `make check-sdk-drift` passes (no uncommitted diff in sdks/)
</verification>

<success_criteria>
- Python SDK provides AuthenticatedClient with search_knowledge, get_knowledge_item, report_outcome methods
- TypeScript SDK provides typed fetch client with equivalent methods
- Both SDKs authenticate via X-API-Key header
- Makefile enables one-command SDK regeneration
- CI drift check prevents stale SDKs from being shipped
</success_criteria>

<output>
After completion, create `.planning/phases/03-quality-intelligence-sdks/03-07-SUMMARY.md`
</output>

---
phase: 04-dashboard-distribution
plan: 04
type: execute
wave: 1
depends_on: []
files_modified:
  - npx/package.json
  - npx/bin/hivemind.js
  - npx/README.md
  - Dockerfile
  - docker-compose.yml
  - .dockerignore
  - README.md
autonomous: true
requirements:
  - DIST-01
  - DIST-02
  - DIST-03

must_haves:
  truths:
    - "A developer can run npx hivemind-mcp and connect to a HiveMind server via stdio-to-HTTP proxy"
    - "A Docker image can be built from the Dockerfile and runs the HiveMind FastAPI server on port 8000"
    - "README contains MCP client config snippets for Claude Desktop, Cursor, VS Code, ChatGPT Desktop, Windsurf, and Gemini CLI"
  artifacts:
    - path: "npx/package.json"
      provides: "npm package definition for hivemind-mcp"
      contains: "hivemind-mcp"
    - path: "npx/bin/hivemind.js"
      provides: "CLI entry point that proxies stdio to HiveMind HTTP via mcp-remote"
      min_lines: 10
    - path: "Dockerfile"
      provides: "Multi-stage Docker build for the HiveMind server"
      contains: "python:3.12-slim"
    - path: "README.md"
      provides: "Install configs for 6 MCP clients"
      contains: "mcpServers"
  key_links:
    - from: "npx/bin/hivemind.js"
      to: "mcp-remote"
      via: "spawn child process calling npx -y mcp-remote"
      pattern: "mcp-remote"
    - from: "Dockerfile"
      to: "hivemind/server/main.py"
      via: "CMD uvicorn hivemind.server.main:app"
      pattern: "hivemind\\.server\\.main"
---

<objective>
Create the three primary distribution artifacts: (1) an npx-installable MCP wrapper package, (2) a production Docker image, and (3) MCP client configuration snippets in the README for all major AI clients.

Purpose: A developer must be able to connect to HiveMind in under 5 minutes via any path — npx one-liner, Docker, or manual config. These are the three on-ramps.
Output: npx/ package directory, Dockerfile, and updated README with client configs.
</objective>

<execution_context>
@/Users/amirkellousidhoum/.claude/get-shit-done/workflows/execute-plan.md
@/Users/amirkellousidhoum/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-dashboard-distribution/04-RESEARCH.md
@hivemind/server/main.py
@pyproject.toml
</context>

<tasks>

<task type="auto">
  <name>Task 1: npx hivemind-mcp one-liner wrapper package</name>
  <files>npx/package.json, npx/bin/hivemind.js, npx/README.md</files>
  <action>
Create `npx/` directory at repo root.

**`npx/package.json`:**
```json
{
  "name": "hivemind-mcp",
  "version": "0.1.0",
  "description": "Connect AI agents to the HiveMind shared knowledge commons via MCP",
  "bin": {
    "hivemind-mcp": "./bin/hivemind.js"
  },
  "dependencies": {
    "mcp-remote": "latest"
  },
  "keywords": ["mcp", "ai", "agents", "knowledge", "hivemind"],
  "license": "MIT",
  "repository": {
    "type": "git",
    "url": "https://github.com/your-org/hivemind"
  }
}
```

**`npx/bin/hivemind.js`** (shebang: `#!/usr/bin/env node`):
1. Parse args: `HIVEMIND_URL` from env or argv[2], `HIVEMIND_API_KEY` from env or argv[3].
2. If no URL provided, print usage message and exit(1):
   ```
   Usage: npx hivemind-mcp <url> [api-key]

   Or set environment variables:
     HIVEMIND_URL=https://your-hivemind-instance.com
     HIVEMIND_API_KEY=your-api-key

   Then: npx hivemind-mcp
   ```
3. Build mcp-remote args: `['mcp-remote', url + '/mcp']`.
4. If api_key provided, add `['--header', 'X-API-Key:' + apiKey]` to args.
5. Spawn: `spawn('npx', ['-y', ...args], { stdio: 'inherit' })`.
6. Forward exit code: `child.on('exit', (code) => process.exit(code ?? 0))`.
7. Handle SIGINT/SIGTERM: forward to child process for clean shutdown.

**`npx/README.md`:**
Brief README for the npm package with:
- What it does (one-liner MCP connection to HiveMind)
- Quick start: `npx hivemind-mcp https://your-instance.com your-api-key`
- Environment variable configuration
- Link to main project README

Verify the package name is available: include a comment in the action noting to check `npm info hivemind-mcp` before publishing (Pitfall 3 from research).
  </action>
  <verify>
`node npx/bin/hivemind.js` (with no args) prints usage and exits with code 1. `cat npx/package.json | python3 -c "import sys,json; d=json.load(sys.stdin); assert d['bin']['hivemind-mcp'] == './bin/hivemind.js'"` passes.
  </verify>
  <done>npx package at npx/ with CLI entry point that proxies stdio to HiveMind HTTP endpoint via mcp-remote, supporting both CLI args and env vars for URL/key config.</done>
</task>

<task type="auto">
  <name>Task 2: Multi-stage Dockerfile + docker-compose + .dockerignore</name>
  <files>Dockerfile, docker-compose.yml, .dockerignore</files>
  <action>
**`Dockerfile`** — Multi-stage build following research pattern:

Stage 1 (builder):
- `FROM python:3.12-slim AS builder`
- Install uv: `RUN pip install uv`
- `WORKDIR /app`
- Copy `pyproject.toml` and `uv.lock`
- `RUN uv sync --frozen --no-dev` (reproducible, no dev deps)

Stage 2 (runtime):
- `FROM python:3.12-slim AS runtime`
- `WORKDIR /app`
- Copy .venv from builder: `COPY --from=builder /app/.venv /app/.venv`
- Copy application code: `COPY hivemind/ hivemind/`
- Copy Alembic: `COPY alembic/ alembic/` and `COPY alembic.ini .`
- Set PATH: `ENV PATH="/app/.venv/bin:$PATH"`
- Expose port: `EXPOSE 8000`
- Healthcheck: `HEALTHCHECK --interval=30s --timeout=5s CMD curl -f http://localhost:8000/health || exit 1`
- CMD: `["uvicorn", "hivemind.server.main:app", "--host", "0.0.0.0", "--port", "8000"]`
- Labels: `LABEL org.opencontainers.image.source=...`, description, license

**`docker-compose.yml`** — Development/demo compose:
- `hivemind` service: builds from Dockerfile, ports 8000:8000, env vars for DATABASE_URL, REDIS_URL, depends_on postgres + redis.
- `postgres` service: `postgres:16-alpine`, pgvector extension (use `pgvector/pgvector:pg16` image), port 5432, volume for data persistence, healthcheck.
- `redis` service: `redis:7-alpine`, port 6379.
- Environment variables via `.env` file reference.

**`.dockerignore`:**
```
.git
.planning
__pycache__
*.pyc
.env
.venv
node_modules
dashboard/node_modules
dashboard/.next
deep_research
sdks
npx/node_modules
*.egg-info
dist
build
```

Ensure the Dockerfile does NOT copy `.env`, `.planning/`, `deep_research/`, or `sdks/` — only the application code.
  </action>
  <verify>
`docker build -t hivemind:test .` builds successfully (or at minimum, the COPY commands don't error — full build requires dependencies). `.dockerignore` exists and excludes `.env` and `.planning`.
  </verify>
  <done>Multi-stage Dockerfile with python:3.12-slim + uv producing a minimal runtime image, docker-compose for full stack (app + postgres + redis), and .dockerignore excluding sensitive/unnecessary files.</done>
</task>

<task type="auto">
  <name>Task 3: MCP client configuration snippets in README</name>
  <files>README.md</files>
  <action>
Update the project README.md (create if it does not exist, or update the existing one) to include a comprehensive "Getting Started" section with MCP client configs for all 6 clients (DIST-03).

Add the following sections:

**Quick Start:**
```
npx hivemind-mcp https://your-hivemind-instance.com your-api-key
```

**MCP Client Configuration:**

For each of the 6 clients, provide the JSON configuration snippet:

1. **Claude Desktop** (`~/Library/Application Support/Claude/claude_desktop_config.json` on macOS, `%APPDATA%\Claude\claude_desktop_config.json` on Windows):
   ```json
   {
     "mcpServers": {
       "hivemind": {
         "command": "npx",
         "args": ["-y", "hivemind-mcp"],
         "env": {
           "HIVEMIND_URL": "https://your-hivemind-instance.com",
           "HIVEMIND_API_KEY": "your-api-key"
         }
       }
     }
   }
   ```

2. **Cursor** (`~/.cursor/mcp.json`):
   Same JSON structure as Claude Desktop.

3. **VS Code** (`.vscode/mcp.json` in workspace):
   Same JSON structure as Claude Desktop.

4. **ChatGPT Desktop** — provide the config path and JSON structure per ChatGPT Desktop's MCP support docs.

5. **Windsurf** — provide config path (`~/.windsurf/mcp.json` or workspace-level) and JSON structure.

6. **Gemini CLI** — provide the config format for Gemini CLI's MCP server configuration.

Note: All configs use the same `mcpServers` JSON format with the `npx hivemind-mcp` command. The only difference is the config file path per client.

**Docker:**
```bash
docker compose up -d
```

**What is HiveMind?** — Brief description of the project (reuse from PROJECT.md core value).

**Available MCP Tools:**
- `add_knowledge` — Contribute knowledge to the commons
- `search_knowledge` — Search the shared knowledge commons
- `list_knowledge` — List your contributions
- `delete_knowledge` — Remove your contributions
- `publish_knowledge` — Publish to the public commons
- `report_outcome` — Report whether knowledge was helpful

Keep the README focused on getting started — not internal architecture. Developers should be able to go from zero to connected in under 5 minutes.
  </action>
  <verify>
`grep -c "mcpServers" README.md` returns at least 6 (one per client config). README contains sections for Claude Desktop, Cursor, VS Code, ChatGPT Desktop, Windsurf, and Gemini CLI.
  </verify>
  <done>README has quick start (npx one-liner), 6 MCP client configs with file paths and JSON snippets, Docker instructions, project description, and tool list — enabling sub-5-minute onboarding.</done>
</task>

</tasks>

<verification>
1. `node npx/bin/hivemind.js` prints usage and exits 1
2. `docker build -t hivemind:test .` builds (or at least parses without COPY errors)
3. `grep "mcpServers" README.md` shows configs for all 6 clients
4. `.dockerignore` excludes `.env`, `.planning`, `node_modules`
</verification>

<success_criteria>
- npx hivemind-mcp package is ready for npm publish with CLI entry point
- Dockerfile produces a minimal production image with uvicorn CMD
- docker-compose provides full-stack dev environment (app + postgres + redis)
- README has working config snippets for Claude Desktop, Cursor, VS Code, ChatGPT Desktop, Windsurf, Gemini CLI
- A developer can go from zero to connected in under 5 minutes using any path
</success_criteria>

<output>
After completion, create `.planning/phases/04-dashboard-distribution/04-04-SUMMARY.md`
</output>
